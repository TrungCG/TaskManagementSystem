{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management</title>
    <link rel="stylesheet" href="{% static 'API/css/style.css' %}">
</head>
<body>

    <!-- Header -->
    <header class="top-bar">
        <div class="top-bar-left">
            <button class="hamburger-btn">
                <svg viewBox="0 0 24 24" width="24" height="24"><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="currentColor"></path></svg>
            </button>
            <div class="create-btn-wrapper">
                <button class="create-button">
                    <svg class="create-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"></path></svg>
                    Create
                </button>
            </div>
        </div>
        <div class="top-bar-center">
            <div class="search-bar">
                 <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
                <input type="text" placeholder="Search student.humg.edu.vn">
            </div>
        </div>
        <div class="top-bar-right">
            <div class="profile-avatar-wrapper" id="profile-wrapper">
                <div class="profile-avatar" id="user-avatar">?</div>
                <svg class="chevron-down" viewBox="0 0 24 24" width="16" height="16"><path d="m7 10 5 5 5-5H7z" fill="currentColor"></path></svg>
                <div class="profile-dropdown hidden" id="logout-dropdown">
                    <button id="logout-button">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" data-nav-id="home"><svg class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>Home</a></li>
                    <li><a href="#" data-nav-id="my-tasks" class="active"><svg class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M9.5,22a.5.5,0,0,1-.5-.5v-3H4a2,2,0,0,1-2-2V4A2,2,0,0,1,4,2h16a2,2,0,0,1,2,2v12a2,2,0,0,1-2,2H14.5a.5.5,0,0,1-.5-.5H9.5M4,4v12h16V4H4m5.5,17h4v-3h-4v3Z" /></svg>My tasks</a></li>
                    <li><a href="#" data-nav-id="inbox"><svg class="icon" viewBox="0 0 24 24"><path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2,0,0,0,4,20H20A2,2,0,0,0,22,18V6C22,4.89,21.1,4,20,4Z" /></svg>Inbox</a></li>
                </ul>
                <div class="nav-section"><div class="nav-section-header"><span>Starred</span></div><ul><li><a href="#"><span class="project-dot starred"></span>Cross-functional project p...</a></li></ul></div>
                <div class="nav-section">
                    <div class="nav-section-header" id="projects-nav-header">
                        <a href="#" data-nav-id="browse-projects"><span>Projects</span></a>
                        <button class="plus-btn" id="add-project-plus-btn">+</button>
                    </div>
                    <ul id="project-list-sidebar"></ul>
                </div>
            </nav>
        </aside>
        
        <main class="dashboard">
            <!-- Giao diện xem Task (Bây giờ là một phần của Project Detail) -->
            <div id="task-view">
                <!-- HEADER MỚI CHO CHI TIẾT DỰ ÁN -->
                <div id="project-detail-header" class="project-detail-header hidden">
                    <div class="project-header-main">
                        <div class="project-header-icon">
                            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15 3H9V5H15V3M19 3H17V5H19V3M21 1H3C1.9 1 1 1.9 1 3V21C1 22.1 1.9 23 3 23H21C22.1 23 23 22.1 23 21V3C23 1.9 22.1 1 21 1M21 21H3V7H21V21M7 3H5V5H7V3Z"></path></svg>
                        </div>
                        <h1 id="project-header-title">Project Name</h1>
                    </div>
                    <div class="project-header-actions">
                        <div class="project-members-stack" id="project-members-stack">
                            <!-- Avatars thành viên sẽ được render ở đây -->
                        </div>
                        <button class="button-secondary" id="manage-members-btn">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12 5.5A3.5 3.5 0 0 1 15.5 9A3.5 3.5 0 0 1 12 12.5A3.5 3.5 0 0 1 8.5 9A3.5 3.5 0 0 1 12 5.5M5 8C5 5.61 6.79 3.73 9 3.2V2H15V3.2C17.21 3.73 19 5.61 19 8V13H20V15H18V19H15V15H9V19H6V15H4V13H5V8Z"></path></svg>
                            Manage Members
                        </button>
                    </div>
                </div>

                <!-- Header chào mừng (chỉ hiển thị khi ở "My Tasks") -->
                <div class="dashboard-header" id="greeting-header">
                    <div class="greeting"><p id="current-date"></p><h1>Good evening, <span id="user-name"></span></h1></div>
                </div>

                <div class="task-container">
                    <div class="task-container-header">
                        <div class="task-title">
                            <div class="avatar" id="task-view-avatar">?</div>
                            <h2 id="task-view-title">My tasks</h2>
                            <svg class="lock-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"></path></svg>
                        </div>
                        <button class="more-btn">...</button>
                    </div>
                    <div class="task-tabs"><button class="tab-item active" data-filter="upcoming">Upcoming</button><button class="tab-item" data-filter="overdue">Overdue</button><button class="tab-item" data-filter="completed">Completed</button></div>
                    <div class="create-task-wrapper"><button class="create-task-button">+ Create task</button></div>
                    <ul class="task-list" id="task-list-container"></ul>
                </div>
            </div>

            <!-- Giao diện Browse Projects -->
            <div id="project-browse-view" class="hidden">
                <div class="project-browse-header">
                    <h1 class="project-browse-title">Browse projects</h1>
                    <button class="create-project-btn" id="create-project-main-btn">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"></path></svg>
                        Create project
                    </button>
                </div>
                <div class="project-filters">
                    <div class="search-bar-local">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
                		<input type="text" placeholder="Find a project">
                    </div>
                </div>
                <div class="project-list-container">
                    <div class="project-list-header">
                        <span>Name</span>
                        <span>Members</span>
                        <span>Teams and portfolios</span>
                        <span style="text-align: right;">Last modified</span>
                    </div>
                    <ul id="project-browse-list"></ul>
                </div>
            </div>
        </main>

        <!-- THANH BÊN MỚI: Chi tiết công việc -->
        <aside class="task-detail-panel hidden" id="task-detail-panel">
            <div class="task-detail-header">
                <h2 id="task-detail-title">Task Title Here</h2>
                <button class="close-panel-btn" id="close-task-panel-btn">&times;</button>
            </div>
            <div class="task-detail-body">
                <div class="task-detail-section">
                    <label>Assignee</label>
                    <p id="task-detail-assignee">...</p>
                </div>
                <div class="task-detail-section">
                    <label>Due Date</label>
                    <p id="task-detail-due-date">...</p>
                </div>
                <div class="task-detail-section">
                    <label>Description</label>
                    <p id="task-detail-description" class="description-text">...</p>
                </div>
                <div class="task-detail-section comments-section">
                    <label>Comments</label>
                    <ul id="task-comments-list">
                        <!-- Comments sẽ được render ở đây -->
                    </ul>
                    <form id="add-comment-form">
                        <textarea name="body" placeholder="Add a comment..." required></textarea>
                        <button type="submit">Comment</button>
                    </form>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modal Đăng nhập / Đăng ký -->
    <div class="auth-modal-overlay hidden" id="auth-modal">
        <div class="auth-modal-content">
            <!-- Login Form -->
            <form id="login-form">
                <h2 class="auth-title">Welcome Back!</h2>
                <p class="auth-subtitle">Log in to continue to your workspace.</p>
                <p class="auth-error" id="login-error"></p>
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" name="username" required placeholder="e.g., yourusername">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" name="password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="auth-button">Log In</button>
                <p class="switch-form-text">Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="hidden">
                <h2 class="auth-title">Create Your Account</h2>
                <p class="auth-subtitle">Get started with a new workspace in minutes.</p>
                <p class="auth-error" id="signup-error"></p>
                <div class="form-group">
                    <label for="signup-username">Username</label>
                    <input type="text" id="signup-username" name="username" required placeholder="e.g., newuser">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="signup-firstname">First Name</label>
                        <input type="text" id="signup-firstname" name="first_name" required placeholder="John">
                    </div>
                    <div class="form-group">
                        <label for="signup-lastname">Last Name</label>
                        <input type="text" id="signup-lastname" name="last_name" required placeholder="Doe">
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" name="email" required placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" name="password" required placeholder="Min. 8 characters">
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" name="confirm_password" required placeholder="Re-enter password">
                </div>
                <button type="submit" class="auth-button">Create Account</button>
                <p class="switch-form-text">Already have an account? <a href="#" id="show-login">Log In</a></p>
            </form>
        </div>
    </div>

    <!-- Modal Create Project -->
    <div class="auth-modal-overlay hidden" id="create-project-modal">
        <div class="auth-modal-content">
            <form id="create-project-form">
                <h2 class="auth-title">Create a new project</h2>
                <p class="auth-subtitle">Projects are where your tasks live. Give it a name to get started.</p>
                <p class="auth-error" id="project-create-error"></p>
                <div class="form-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" id="project-name" name="name" required placeholder="e.g., Q1 Marketing Campaign">
                </div>
                <div class="form-group">
                    <label for="project-description">Description (optional)</label>
                    <textarea id="project-description" name="description" rows="3" placeholder="Add more details about this project..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="button-secondary" id="cancel-create-project">Cancel</button>
                    <button type="submit" class="auth-button">Create Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL MỚI: Quản lý Thành viên -->
    <div class="auth-modal-overlay hidden" id="member-management-modal">
        <div class="auth-modal-content" style="max-width: 500px;">
            <h2 class="auth-title">Manage Members</h2>
            <p class="auth-subtitle" id="member-modal-project-name">Project Name</p>
            
            <!-- Thêm thành viên mới -->
            <div class="add-member-section">
                <label>Add new member</label>
                <div class="search-user-wrapper">
                    <input type="text" id="user-search-input" placeholder="Search by username or email...">
                    <div class="search-results-box hidden" id="user-search-results"></div>
                </div>
            </div>

            <!-- Danh sách thành viên hiện tại -->
            <div class="current-members-section">
                <label>Project Members</label>
                <ul id="current-members-list">
                    <!-- Danh sách thành viên sẽ được render ở đây -->
                </ul>
            </div>
            <div class="form-actions">
                <button type="button" class="button-secondary" id="close-member-modal-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="toast hidden">
        <div class="toast-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        </div>
        <p class="toast-message">Account created successfully!</p>
    </div>

    <script src="{% static 'API/js/api.js' %}"></script>
    <script src="{% static 'API/js/main.js' %}"></script>
</body>
</html>